"use strict";(self.webpackChunke_commer_react=self.webpackChunke_commer_react||[]).push([[580],{580:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var r=a(379),o=a(483),c=a(376);var s=a(723);function i(e){let{darkMode:t=!1}=e;const[a,i]=(0,o.useState)([]);(0,o.useEffect)(()=>{try{const e=localStorage.getItem("ecommerce_products");e&&i(JSON.parse(e))}catch(e){i([])}},[]);const l=(0,c.Zp)(),[n,d]=(0,o.useState)(null),[m,g]=(0,o.useState)(!0),[u,p]=(0,o.useState)(""),[h,y]=(0,o.useState)(!1),[x,j]=(0,o.useState)(!1),[v,f]=(0,o.useState)(!1),[N,S]=(0,o.useState)(!1),[w,b]=(0,o.useState)(!1),[I,A]=(0,o.useState)([]),[E,C]=(0,o.useState)(["electronics","clothing","books","home","sports","other"]),[k,P]=(0,o.useState)(""),[q,_]=(0,o.useState)({title:"",price:"",quantity:1,image:"",description:"",category:"electronics"}),[O,T]=(0,o.useState)(null),U=["yahiapro400@gmail.com","yahiacool2009@gmail.com"],F=()=>{const e=localStorage.getItem("currentUserEmail")||localStorage.getItem("loggedInUser")||localStorage.getItem("userEmail");return e&&U.includes(e)},D=()=>{const e=localStorage.getItem("currentUserEmail")||localStorage.getItem("loggedInUser")||localStorage.getItem("userEmail");return e&&U.includes(e)};(0,o.useEffect)(()=>{const e=localStorage.getItem("currentUserEmail")||localStorage.getItem("loggedInUser")||localStorage.getItem("userEmail");if(!e){return 0===JSON.parse(localStorage.getItem("users")||"[]").length?(d({email:"admin@gmail.com"}),J(),L(),void g(!1)):void l("/login")}const t=JSON.parse(localStorage.getItem("users")||"[]").find(t=>t.email===e);if(!t){return["yahiapro400@gmail.com","yahiacool2009@gmail.com"].includes(e)?(d({email:e}),J(),L(),void g(!1)):void l("/login")}if(!["yahiapro400@gmail.com","yahiacool2009@gmail.com"].includes(t.email))return void l("/");d(t),J(),L(),setTimeout(()=>{I.forEach(e=>{e.image&&((new Image).src=e.image)})},100);try{const e=JSON.parse(localStorage.getItem("ecommerce_products")||"[]");if(e.length>50){const t=e.slice(-50);localStorage.setItem("ecommerce_products",JSON.stringify(t)),console.log("\ud83e\uddf9 Auto-cleanup: Reduced products from",e.length,"to",t.length)}}catch(o){console.error("Error during auto-cleanup:",o)}B(),g(!1);const a=e=>{"ecommerce_products"===e.key&&(clearTimeout(window.storageTimeout),window.storageTimeout=setTimeout(()=>{J()},500))};window.addEventListener("storage",a);const r=e=>{e.target.closest(".category-selector")||b(!1)};return document.addEventListener("mousedown",r),()=>{window.removeEventListener("storage",a),document.removeEventListener("mousedown",r),clearTimeout(window.storageTimeout)}},[l]);const J=()=>{try{const e=localStorage.getItem("ecommerce_products");if(e){const t=JSON.parse(e);A(t)}}catch(e){console.error("Error loading products:",e),A([])}},L=()=>{try{const e=localStorage.getItem("ecommerce_categories");if(e){const t=JSON.parse(e);C(t)}}catch(e){console.error("Error loading categories:",e)}},B=()=>{try{["ecommerce_products_old","ecommerce_categories_old","cartItems_old","users_old"].forEach(e=>{try{localStorage.removeItem(e)}catch(t){console.warn("Failed to remove ".concat(e,":"),t)}});try{sessionStorage.clear()}catch(e){console.warn("Failed to clear sessionStorage:",e)}console.log("\u2705 Storage cleanup completed")}catch(t){console.error("Error during storage cleanup:",t)}},M=e=>{const{name:t,value:a}=e.target;_(e=>(0,r.A)((0,r.A)({},e),{},{[t]:a}))},R=e=>{const{name:t,value:a}=e.target;T(e=>(0,r.A)((0,r.A)({},e),{},{[t]:a}))},W=()=>{_({title:"",price:"",quantity:1,image:"",description:"",category:"electronics"}),p("Form cleared successfully!"),setTimeout(()=>p(""),3e3)};if(m)return(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",background:"#f5f7fa"},children:(0,s.jsxs)("div",{style:{textAlign:"center",color:"#666"},children:[(0,s.jsx)("div",{style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #667eea",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 20px"}}),(0,s.jsx)("p",{children:"Loading..."})]})});const H=localStorage.getItem("currentUserEmail")||localStorage.getItem("loggedInUser")||localStorage.getItem("userEmail"),Q=JSON.parse(localStorage.getItem("users")||"[]");return!H&&Q.length>0?(0,s.jsxs)("div",{className:"access-denied",children:[(0,s.jsx)("h1",{children:"Access Denied"}),(0,s.jsx)("p",{children:"You don't have permission to access this page."}),(0,s.jsx)("button",{onClick:()=>l("/"),children:"Go Home"})]}):(0,s.jsxs)("div",{className:"add-products-container ".concat(t?"dark-mode":""),children:[(0,s.jsxs)("div",{className:"add-products-header",children:[(0,s.jsx)("h1",{children:"Product Management"}),(0,s.jsx)("p",{children:"Add, edit, and manage your products"})]}),u&&(0,s.jsx)("div",{className:"message ".concat(u.includes("successfully")?"success":"error"),children:u}),!v&&a&&a.length>0&&(0,s.jsxs)("div",{className:"products-section",style:{marginTop:"16px"},children:[(0,s.jsx)("div",{className:"products-header",children:(0,s.jsxs)("h2",{children:["Strapi Products (",a.length,")"]})}),(0,s.jsx)("div",{className:"products-grid"})]}),(0,s.jsxs)("div",{className:"admin-actions",children:[!v&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("button",{className:"add-product-btn",onClick:()=>{y(!h),T(null)},children:h?"Cancel":"Add New Product"})}),(0,s.jsx)("button",{className:"categories-management-btn",onClick:()=>{f(!v),v||setTimeout(()=>{const e=document.querySelector(".categories-section");e&&e.scrollIntoView({behavior:"smooth"})},100)},title:"Manage product categories",children:v?"\u2b06\ufe0f Back to Top":"\ud83d\udcc2 Categories"})]}),h&&!v&&(0,s.jsxs)("div",{className:"product-form-container",children:[(0,s.jsx)("h2",{children:O?"Edit Product":"Add New Product"}),(0,s.jsxs)("form",{onSubmit:O?async e=>{if(e.preventDefault(),!O.title||!O.price||!O.image||!O.quantity)return void p("Please fill in all required fields");if(O.isProtected&&!D())return void alert("\u274c Cannot edit protected products!\n\nOnly yahiapro400@gmail.com and yahiacool2009@gmail.com can edit protected products.");const t=(0,r.A)((0,r.A)({},O),{},{price:parseFloat(O.price),quantity:parseInt(O.quantity),updatedAt:(new Date).toISOString(),updatedBy:"".concat(localStorage.getItem("currentUserEmail")||localStorage.getItem("loggedInUser")||localStorage.getItem("userEmail")||"Admin"," (Admin)")}),a=I.map(e=>e.id===O.id?t:e);A(a);try{localStorage.setItem("ecommerce_products",JSON.stringify(a))}catch(o){}window.dispatchEvent(new Event("productsUpdated")),p('\u2705 Product "'.concat(O.title,'" updated')),T(null),y(!1),setTimeout(()=>p(""),3e3)}:async e=>{if(e.preventDefault(),!q.title||!q.price||!q.image||!q.quantity)return void p("Please fill in all required fields");const t={id:Date.now(),title:q.title||"",price:parseFloat(q.price)||0,quantity:parseInt(q.quantity)||1,image:q.image||"",description:q.description||"",category:q.category||"other",createdAt:(new Date).toISOString(),createdBy:"".concat(localStorage.getItem("currentUserEmail")||localStorage.getItem("loggedInUser")||localStorage.getItem("userEmail")||"Admin"," (Admin)"),isProtected:F()},a=[...I,t];A(a);try{const e=a.map(e=>({id:e.id,title:e.title,price:e.price,quantity:e.quantity,image:e.image,description:e.description,category:e.category,createdAt:e.createdAt})),t=e.slice(-50),c=JSON.stringify(t);try{localStorage.setItem("ecommerce_products",c)}catch(r){console.warn("Storage error, trying to clear old data:",r);try{localStorage.removeItem("ecommerce_products"),localStorage.setItem("ecommerce_products",c)}catch(o){throw console.error("Failed to store even after cleanup:",o),new Error("Storage is full or not available")}}const s=localStorage.getItem("ecommerce_products");if(!s)throw new Error("Failed to store products");console.log("\u2705 Successfully stored ".concat(t.length," products in localStorage"));JSON.parse(s).length!==t.length&&console.warn("Storage verification failed, data may be corrupted")}catch(c){console.error("Error storing products:",c);try{const e=JSON.stringify(a.slice(-20));sessionStorage.setItem("ecommerce_products_fallback",e),console.log("\u2705 Saved to sessionStorage as fallback"),p("\u26a0\ufe0f Warning: Product added to temporary storage. Data may be lost on page refresh.")}catch(s){console.error("Fallback storage also failed:",s),p("\u274c Error: Unable to save product. Please try again or clear browser data.")}setTimeout(()=>p(""),8e3)}window.dispatchEvent(new Event("productsUpdated")),p('\u2705 Product "'.concat(t.title,'" with ').concat(t.quantity," pieces added successfully!")),W(),l("/")},className:"product-form",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"title",children:"Product Title *"}),(0,s.jsx)("input",{type:"text",id:"title",name:"title",value:O?O.title:q.title,onChange:O?R:M,placeholder:"Enter product title",required:!0})]}),(0,s.jsxs)("div",{className:"form-row",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"price",children:"Price *"}),(0,s.jsx)("input",{type:"number",id:"price",name:"price",value:O?O.price:q.price,onChange:O?R:M,placeholder:"0.00",step:"0.01",min:"0",required:!0})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"quantity",children:"Quantity *"}),(0,s.jsx)("input",{type:"number",id:"quantity",name:"quantity",value:O?O.quantity:q.quantity,onChange:O?R:M,placeholder:"1",min:"1",required:!0})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"category",children:"Category *"}),(0,s.jsxs)("div",{className:"category-selector",children:[(0,s.jsxs)("button",{type:"button",className:"category-dropdown-btn",onClick:()=>b(!w),children:[O?O.category:q.category,(0,s.jsx)("span",{className:"dropdown-arrow",children:"\u25bc"})]}),w&&(0,s.jsx)("div",{className:"category-dropdown",children:E.map(e=>(0,s.jsx)("div",{className:"category-option",onClick:()=>{O?T(t=>(0,r.A)((0,r.A)({},t),{},{category:e})):_(t=>(0,r.A)((0,r.A)({},t),{},{category:e})),b(!1)},children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"image",children:"Product Image *"}),(0,s.jsxs)("div",{className:"image-upload-container",children:[(0,s.jsx)("input",{type:"text",id:"image",name:"image",value:O?O.image:q.image,onChange:O?R:M,placeholder:"Enter image URL (supports: jpg, png, webp, gif)",required:!0}),(0,s.jsx)("input",{type:"file",id:"imageFile",accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{O?T(t=>(0,r.A)((0,r.A)({},t),{},{image:e.target.result})):_(t=>(0,r.A)((0,r.A)({},t),{},{image:e.target.result}))},e.readAsDataURL(t)}},className:"file-input"}),(0,s.jsxs)("label",{htmlFor:"imageFile",className:"file-label",children:[(0,s.jsxs)("svg",{className:"upload-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,s.jsx)("polyline",{points:"7,10 12,15 17,10"}),(0,s.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Choose Image"]}),(O?O.image:q.image)&&(0,s.jsxs)("div",{className:"image-preview",children:[(0,s.jsx)("img",{src:O?O.image:q.image,alt:"Preview",loading:"eager",decoding:"async"}),(0,s.jsx)("button",{type:"button",className:"remove-image",onClick:()=>{O?T(e=>(0,r.A)((0,r.A)({},e),{},{image:""})):_(e=>(0,r.A)((0,r.A)({},e),{},{image:""}))},children:"\xd7"})]})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"description",children:"Description"}),(0,s.jsx)("textarea",{id:"description",name:"description",value:O?O.description:q.description,onChange:O?R:M,rows:"4",placeholder:"Enter product description"})]}),(0,s.jsxs)("div",{className:"form-actions",children:[(0,s.jsx)("button",{type:"submit",className:"submit-btn",children:O?"Update Product":"Add Product"}),(0,s.jsx)("button",{type:"button",className:"cancel-btn",onClick:()=>{y(!1),T(null)},children:"Cancel"})]})]})]}),!v&&(0,s.jsxs)("div",{className:"products-section",children:[(0,s.jsx)("div",{className:"products-header",children:(0,s.jsxs)("h2",{children:["Products Management (",I.length,")"]})}),0===I.length?(0,s.jsx)("div",{className:"no-products",children:(0,s.jsx)("p",{children:"No products added yet."})}):(0,s.jsx)("div",{className:"products-grid",children:I.map(e=>(0,s.jsxs)("div",{className:"product-card",children:[(0,s.jsxs)("div",{className:"product-image",children:[(0,s.jsx)("img",{src:e.image,alt:e.title,loading:"eager",decoding:"async",fetchPriority:"high",style:{border:"2px solid red"}}),(0,s.jsxs)("div",{className:"image-placeholder",style:{display:"none"},children:[(0,s.jsx)("span",{children:"\ud83d\udcf7"}),(0,s.jsx)("p",{children:"No Image"})]}),(0,s.jsx)("div",{className:"stock-status-overlay",children:0===e.quantity?(0,s.jsxs)("span",{className:"out-of-stock-overlay",children:[(0,s.jsx)("span",{className:"stock-icon",children:"\u274c"}),(0,s.jsx)("span",{className:"stock-text",children:"Out of Stock"})]}):e.quantity<=5?(0,s.jsxs)("span",{className:"low-stock-overlay",children:[(0,s.jsx)("span",{className:"stock-icon",children:"\u26a0\ufe0f"}),(0,s.jsx)("span",{className:"stock-text",children:"Low Stock"})]}):(0,s.jsxs)("span",{className:"in-stock-overlay",children:[(0,s.jsx)("span",{className:"stock-icon",children:"\u2705"}),(0,s.jsx)("span",{className:"stock-text",children:"In Stock"})]})}),e.updatedAt&&(0,s.jsx)("div",{className:"updated-badge",children:"Updated"}),e.isProtected&&(0,s.jsx)("div",{className:"protected-badge",children:"\ud83d\udd12 Protected"})]}),(0,s.jsxs)("div",{className:"product-info",children:[(0,s.jsx)("h3",{children:e.title}),(0,s.jsxs)("p",{className:"price",children:["$",e.price]}),(0,s.jsxs)("p",{className:"quantity",children:["Quantity: ",e.quantity||1]}),(0,s.jsx)("p",{className:"category",children:e.category}),e.description&&(0,s.jsx)("p",{className:"description",children:e.description}),(0,s.jsxs)("p",{className:"product-id",children:["ID: ",e.id]}),(0,s.jsxs)("p",{className:"created-date",children:["Created: ",new Date(e.createdAt).toLocaleDateString(),e.createdBy&&" by ".concat(e.createdBy)]}),e.updatedAt&&(0,s.jsxs)("p",{className:"updated-date",children:["Updated: ",new Date(e.updatedAt).toLocaleDateString(),e.updatedBy&&" by ".concat(e.updatedBy)]}),e.isProtected&&(0,s.jsx)("p",{className:"protected-info",children:"\ud83d\udd12 Protected Product - Only yahiapro400@gmail.com and yahiacool2009@gmail.com can modify"})]}),(0,s.jsxs)("div",{className:"product-actions",children:[(0,s.jsx)("button",{className:"edit-btn",onClick:()=>{T((0,r.A)((0,r.A)({},e),{},{price:e.price.toString(),quantity:e.quantity.toString()})),y(!0)},title:"Edit Product",children:"\u270f\ufe0f Edit"}),(0,s.jsx)("button",{className:"delete-btn",onClick:()=>{const t=I.find(t=>t.id===e.id);if(t&&t.isProtected&&!D())alert("\u274c Cannot delete protected products!\n\nOnly yahiapro400@gmail.com and yahiacool2009@gmail.com can delete protected products.");else if(window.confirm("Are you sure you want to delete this product?")){const r=I.filter(t=>t.id!==e.id);A(r);try{const e=r.slice(-50),t=JSON.stringify(e);localStorage.setItem("ecommerce_products",t);if(!localStorage.getItem("ecommerce_products"))throw new Error("Failed to store products");console.log("\u2705 Successfully deleted product. ".concat(e.length," products remaining in localStorage"))}catch(a){console.error("Error deleting product:",a),p("\u26a0\ufe0f Warning: Product deleted but storage may be limited."),setTimeout(()=>p(""),5e3)}window.dispatchEvent(new Event("productsUpdated")),p('Product "'.concat(t.title,'" deleted successfully! Remaining products: ').concat(r.length)),setTimeout(()=>p(""),3e3)}},title:"Delete Product",children:"\ud83d\uddd1\ufe0f Delete"})]})]},e.id))})]}),v&&(0,s.jsxs)("div",{className:"categories-section",children:[(0,s.jsxs)("div",{className:"categories-header",children:[(0,s.jsxs)("h2",{children:["Categories Management (",E.length,")"]}),(0,s.jsxs)("div",{className:"categories-actions",children:[(0,s.jsx)("button",{className:"add-category-btn",onClick:()=>S(!N),children:N?"Cancel":"\u2795 Add New Category"}),(0,s.jsx)("button",{className:"back-to-top-btn",onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},children:"\u2b06\ufe0f Back to Top"})]})]}),N&&(0,s.jsx)("div",{className:"category-form",children:(0,s.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!k.trim())return void p("Please enter a category name");const t=k.trim().toLowerCase();if(E.includes(t))return void p("This category already exists");const a=[...E,t];C(a),localStorage.setItem("ecommerce_categories",JSON.stringify(a)),P(""),S(!1),p('Category "'.concat(t,'" added successfully!')),setTimeout(()=>p(""),3e3)},children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"newCategory",children:"Category Name"}),(0,s.jsx)("input",{type:"text",id:"newCategory",value:k,onChange:e=>P(e.target.value),placeholder:"Enter category name",required:!0})]}),(0,s.jsx)("button",{type:"submit",className:"submit-btn",children:"Add Category"})]})}),(0,s.jsx)("div",{className:"categories-grid",children:E.map(e=>(0,s.jsxs)("div",{className:"category-card",children:[(0,s.jsxs)("div",{className:"category-info",children:[(0,s.jsx)("h3",{children:e.charAt(0).toUpperCase()+e.slice(1)}),(0,s.jsxs)("p",{children:["Products in this category: ",I.filter(t=>t.category===e).length]})]}),(0,s.jsx)("div",{className:"category-actions",children:(0,s.jsx)("button",{className:"delete-category-btn",onClick:()=>(e=>{if(window.confirm('Are you sure you want to delete the category "'.concat(e,'"? This will also remove it from all products.')))try{const t=E.filter(t=>t!==e);C(t),localStorage.setItem("ecommerce_categories",JSON.stringify(t));const a=I.map(t=>t.category===e?(0,r.A)((0,r.A)({},t),{},{category:"Other"}):t);A(a),localStorage.setItem("ecommerce_products",JSON.stringify(a)),window.dispatchEvent(new Event("productsUpdated")),p('\u2705 Category "'.concat(e,'" deleted successfully! Products moved to "Other" category.')),setTimeout(()=>p(""),4e3),console.log('\u2705 Category "'.concat(e,'" deleted and products updated'))}catch(t){console.error("Error deleting category:",t),p("\u26a0\ufe0f Error deleting category"),setTimeout(()=>p(""),3e3)}})(e),disabled:"other"===e,title:"other"===e?"Cannot delete default category":"Delete category",children:"\ud83d\uddd1\ufe0f Delete"})})]},e))})]})]})}}}]);
//# sourceMappingURL=580.68d6b534.chunk.js.map