"use strict";(self.webpackChunke_commer_react=self.webpackChunke_commer_react||[]).push([[614],{614:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var r=a(43),o=a(216),s=a(579);function c(e){let{darkMode:t=!1}=e;const a=(0,o.Zp)(),[c,i]=(0,r.useState)(null),[l,n]=(0,r.useState)(!0),[d,m]=(0,r.useState)(""),[g,u]=(0,r.useState)(!1),[p,h]=(0,r.useState)(!1),[y,x]=(0,r.useState)(!1),[f,j]=(0,r.useState)(!1),[v,S]=(0,r.useState)(!1),[N,w]=(0,r.useState)([]),[b,I]=(0,r.useState)(["electronics","clothing","books","home","sports","other"]),[E,k]=(0,r.useState)(""),[C,P]=(0,r.useState)({title:"",price:"",quantity:1,image:"",description:"",category:"electronics"}),[_,q]=(0,r.useState)(null),A=["yahiapro400@gmail.com","yahiacool2009@gmail.com"],O=()=>{const e=localStorage.getItem("currentUserEmail")||localStorage.getItem("loggedInUser")||localStorage.getItem("userEmail");return e&&A.includes(e)},T=()=>{const e=localStorage.getItem("currentUserEmail")||localStorage.getItem("loggedInUser")||localStorage.getItem("userEmail");return e&&A.includes(e)};(0,r.useEffect)(()=>{const e=localStorage.getItem("currentUserEmail")||localStorage.getItem("loggedInUser")||localStorage.getItem("userEmail");if(!e){return 0===JSON.parse(localStorage.getItem("users")||"[]").length?(i({email:"admin@gmail.com"}),U(),F(),void n(!1)):void a("/login")}const t=JSON.parse(localStorage.getItem("users")||"[]").find(t=>t.email===e);if(!t){return["yahiapro400@gmail.com","yahiacool2009@gmail.com","admin-test@gmail.com","admin@gmail.com"].includes(e)?(i({email:e}),U(),F(),void n(!1)):void a("/login")}if(!["yahiapro400@gmail.com","yahiacool2009@gmail.com","admin-test@gmail.com","admin@gmail.com"].includes(t.email))return void a("/");i(t),U(),F(),setTimeout(()=>{N.forEach(e=>{e.image&&((new Image).src=e.image)})},100);try{const e=JSON.parse(localStorage.getItem("ecommerce_products")||"[]");if(e.length>50){const t=e.slice(-50);localStorage.setItem("ecommerce_products",JSON.stringify(t)),console.log("\ud83e\uddf9 Auto-cleanup: Reduced products from",e.length,"to",t.length)}}catch(s){console.error("Error during auto-cleanup:",s)}D(),n(!1);const r=e=>{"ecommerce_products"===e.key&&(clearTimeout(window.storageTimeout),window.storageTimeout=setTimeout(()=>{U()},500))};window.addEventListener("storage",r);const o=e=>{e.target.closest(".category-selector")||S(!1)};return document.addEventListener("mousedown",o),()=>{window.removeEventListener("storage",r),document.removeEventListener("mousedown",o),clearTimeout(window.storageTimeout)}},[a]);const U=()=>{try{const e=localStorage.getItem("ecommerce_products");if(e){const t=JSON.parse(e);w(t)}}catch(e){console.error("Error loading products:",e),w([])}},F=()=>{try{const e=localStorage.getItem("ecommerce_categories");if(e){const t=JSON.parse(e);I(t)}}catch(e){console.error("Error loading categories:",e)}},D=()=>{try{["ecommerce_products_old","ecommerce_categories_old","cartItems_old","users_old"].forEach(e=>{try{localStorage.removeItem(e)}catch(t){console.warn(`Failed to remove ${e}:`,t)}});try{sessionStorage.clear()}catch(e){console.warn("Failed to clear sessionStorage:",e)}console.log("\u2705 Storage cleanup completed")}catch(t){console.error("Error during storage cleanup:",t)}},$=e=>{const{name:t,value:a}=e.target;P(e=>({...e,[t]:a}))},J=e=>{const{name:t,value:a}=e.target;q(e=>({...e,[t]:a}))},L=()=>{P({title:"",price:"",quantity:1,image:"",description:"",category:"electronics"}),m("Form cleared successfully!"),setTimeout(()=>m(""),3e3)};if(l)return(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",background:"#f5f7fa"},children:(0,s.jsxs)("div",{style:{textAlign:"center",color:"#666"},children:[(0,s.jsx)("div",{style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #667eea",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 20px"}}),(0,s.jsx)("p",{children:"Loading..."})]})});const B=localStorage.getItem("currentUserEmail")||localStorage.getItem("loggedInUser")||localStorage.getItem("userEmail"),M=JSON.parse(localStorage.getItem("users")||"[]");return!B&&M.length>0?(0,s.jsxs)("div",{className:"access-denied",children:[(0,s.jsx)("h1",{children:"Access Denied"}),(0,s.jsx)("p",{children:"You don't have permission to access this page."}),(0,s.jsx)("button",{onClick:()=>a("/"),children:"Go Home"})]}):(0,s.jsxs)("div",{className:"add-products-container "+(t?"dark-mode":""),children:[(0,s.jsxs)("div",{className:"add-products-header",children:[(0,s.jsx)("h1",{children:"Product Management"}),(0,s.jsx)("p",{children:"Add, edit, and manage your products"})]}),d&&(0,s.jsx)("div",{className:"message "+(d.includes("successfully")?"success":"error"),children:d}),(0,s.jsxs)("div",{className:"admin-actions",children:[!y&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("button",{className:"add-product-btn",onClick:()=>{u(!g),q(null)},children:g?"Cancel":"Add New Product"})}),(0,s.jsx)("button",{className:"categories-management-btn",onClick:()=>{x(!y),y||setTimeout(()=>{const e=document.querySelector(".categories-section");e&&e.scrollIntoView({behavior:"smooth"})},100)},title:"Manage product categories",children:y?"\u2b06\ufe0f Back to Top":"\ud83d\udcc2 Categories"})]}),g&&!y&&(0,s.jsxs)("div",{className:"product-form-container",children:[(0,s.jsx)("h2",{children:_?"Edit Product":"Add New Product"}),(0,s.jsxs)("form",{onSubmit:_?e=>{if(e.preventDefault(),!_.title||!_.price||!_.image||!_.quantity)return void m("Please fill in all required fields");if(_.isProtected&&!T())return void alert("\u274c Cannot edit protected products!\n\nOnly yahiapro400@gmail.com and yahiacool2009@gmail.com can edit protected products.");const t={..._,price:parseFloat(_.price),quantity:parseInt(_.quantity),updatedAt:(new Date).toISOString(),updatedBy:`${localStorage.getItem("currentUserEmail")||localStorage.getItem("loggedInUser")||localStorage.getItem("userEmail")||"Admin"} (Admin)`},a=N.map(e=>e.id===_.id?t:e);w(a);try{const e=a.slice(-50),t=JSON.stringify(e);try{localStorage.setItem("ecommerce_products",t)}catch(r){console.warn("Storage error during edit, trying to clear old data:",r);try{localStorage.removeItem("ecommerce_products"),localStorage.setItem("ecommerce_products",t)}catch(o){throw console.error("Failed to store even after cleanup:",o),new Error("Storage is full or not available")}}const s=localStorage.getItem("ecommerce_products");if(!s)throw new Error("Failed to store products");console.log(`\u2705 Successfully updated product. ${e.length} products in localStorage`);JSON.parse(s).length!==e.length&&console.warn("Storage verification failed during edit, data may be corrupted")}catch(s){console.error("Error updating product:",s);try{const e=JSON.stringify(a.slice(-20));sessionStorage.setItem("ecommerce_products_fallback",e),console.log("\u2705 Saved to sessionStorage as fallback during edit"),m("\u26a0\ufe0f Warning: Product updated in temporary storage. Data may be lost on page refresh.")}catch(c){console.error("Fallback storage also failed during edit:",c),m("\u274c Error: Unable to update product. Please try again or clear browser data.")}setTimeout(()=>m(""),8e3)}window.dispatchEvent(new Event("productsUpdated")),m(`\u2705 Product "${t.title}" updated successfully!`),q(null),u(!1),setTimeout(()=>m(""),3e3)}:e=>{if(e.preventDefault(),!C.title||!C.price||!C.image||!C.quantity)return void m("Please fill in all required fields");const t={id:Date.now(),title:C.title,price:parseFloat(C.price),quantity:parseInt(C.quantity),image:C.image,description:C.description,category:C.category,createdAt:(new Date).toISOString(),createdBy:`${localStorage.getItem("currentUserEmail")||localStorage.getItem("loggedInUser")||localStorage.getItem("userEmail")||"Admin"} (Admin)`,isProtected:O()},a=[...N,t];w(a);try{const e=a.map(e=>({id:e.id,title:e.title,price:e.price,quantity:e.quantity,image:e.image,description:e.description,category:e.category,createdAt:e.createdAt})),t=e.slice(-50),s=JSON.stringify(t);try{localStorage.setItem("ecommerce_products",s)}catch(r){console.warn("Storage error, trying to clear old data:",r);try{localStorage.removeItem("ecommerce_products"),localStorage.setItem("ecommerce_products",s)}catch(o){throw console.error("Failed to store even after cleanup:",o),new Error("Storage is full or not available")}}const c=localStorage.getItem("ecommerce_products");if(!c)throw new Error("Failed to store products");console.log(`\u2705 Successfully stored ${t.length} products in localStorage`);JSON.parse(c).length!==t.length&&console.warn("Storage verification failed, data may be corrupted")}catch(s){console.error("Error storing products:",s);try{const e=JSON.stringify(a.slice(-20));sessionStorage.setItem("ecommerce_products_fallback",e),console.log("\u2705 Saved to sessionStorage as fallback"),m("\u26a0\ufe0f Warning: Product added to temporary storage. Data may be lost on page refresh.")}catch(c){console.error("Fallback storage also failed:",c),m("\u274c Error: Unable to save product. Please try again or clear browser data.")}setTimeout(()=>m(""),8e3)}window.dispatchEvent(new Event("productsUpdated")),m(`\u2705 Product "${t.title}" with ${t.quantity} pieces added successfully!`),L(),setTimeout(()=>{m(""),window.location.href="/"},2e3)},className:"product-form",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"title",children:"Product Title *"}),(0,s.jsx)("input",{type:"text",id:"title",name:"title",value:_?_.title:C.title,onChange:_?J:$,placeholder:"Enter product title",required:!0})]}),(0,s.jsxs)("div",{className:"form-row",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"price",children:"Price *"}),(0,s.jsx)("input",{type:"number",id:"price",name:"price",value:_?_.price:C.price,onChange:_?J:$,placeholder:"0.00",step:"0.01",min:"0",required:!0})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"quantity",children:"Quantity *"}),(0,s.jsx)("input",{type:"number",id:"quantity",name:"quantity",value:_?_.quantity:C.quantity,onChange:_?J:$,placeholder:"1",min:"1",required:!0})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"category",children:"Category *"}),(0,s.jsxs)("div",{className:"category-selector",children:[(0,s.jsxs)("button",{type:"button",className:"category-dropdown-btn",onClick:()=>S(!v),children:[_?_.category:C.category,(0,s.jsx)("span",{className:"dropdown-arrow",children:"\u25bc"})]}),v&&(0,s.jsx)("div",{className:"category-dropdown",children:b.map(e=>(0,s.jsx)("div",{className:"category-option",onClick:()=>{_?q(t=>({...t,category:e})):P(t=>({...t,category:e})),S(!1)},children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"image",children:"Product Image *"}),(0,s.jsxs)("div",{className:"image-upload-container",children:[(0,s.jsx)("input",{type:"text",id:"image",name:"image",value:_?_.image:C.image,onChange:_?J:$,placeholder:"Enter image URL (supports: jpg, png, webp, gif)",required:!0}),(0,s.jsx)("input",{type:"file",id:"imageFile",accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{_?q(t=>({...t,image:e.target.result})):P(t=>({...t,image:e.target.result}))},e.readAsDataURL(t)}},className:"file-input"}),(0,s.jsxs)("label",{htmlFor:"imageFile",className:"file-label",children:[(0,s.jsxs)("svg",{className:"upload-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,s.jsx)("polyline",{points:"7,10 12,15 17,10"}),(0,s.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Choose Image"]}),(_?_.image:C.image)&&(0,s.jsxs)("div",{className:"image-preview",children:[(0,s.jsx)("img",{src:_?_.image:C.image,alt:"Preview",loading:"eager",decoding:"async",onLoad:e=>{e.target.style.opacity="1"},style:{opacity:0,transition:"opacity 0.3s ease"}}),(0,s.jsx)("button",{type:"button",className:"remove-image",onClick:()=>{_?q(e=>({...e,image:""})):P(e=>({...e,image:""}))},children:"\xd7"})]})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"description",children:"Description"}),(0,s.jsx)("textarea",{id:"description",name:"description",value:_?_.description:C.description,onChange:_?J:$,rows:"4",placeholder:"Enter product description"})]}),(0,s.jsxs)("div",{className:"form-actions",children:[(0,s.jsx)("button",{type:"submit",className:"submit-btn",children:_?"Update Product":"Add Product"}),(0,s.jsx)("button",{type:"button",className:"cancel-btn",onClick:()=>{u(!1),q(null)},children:"Cancel"})]})]})]}),!y&&(0,s.jsxs)("div",{className:"products-section",children:[(0,s.jsx)("div",{className:"products-header",children:(0,s.jsxs)("h2",{children:["Products Management (",N.length,")"]})}),0===N.length?(0,s.jsx)("div",{className:"no-products",children:(0,s.jsx)("p",{children:"No products added yet."})}):(0,s.jsx)("div",{className:"products-grid",children:N.map(e=>(0,s.jsxs)("div",{className:"product-card",children:[(0,s.jsxs)("div",{className:"product-image",children:[(0,s.jsx)("img",{src:e.image,alt:e.title,loading:"eager",decoding:"async",fetchPriority:"high",onLoad:e=>{e.target.style.opacity="1",e.target.style.transform="scale(1)"},onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="block"},style:{opacity:0,transform:"scale(0.95)",transition:"all 0.3s ease"}}),(0,s.jsxs)("div",{className:"image-placeholder",style:{display:"none"},children:[(0,s.jsx)("span",{children:"\ud83d\udcf7"}),(0,s.jsx)("p",{children:"No Image"})]}),(0,s.jsx)("div",{className:"stock-status-overlay",children:0===e.quantity?(0,s.jsxs)("span",{className:"out-of-stock-overlay",children:[(0,s.jsx)("span",{className:"stock-icon",children:"\u274c"}),(0,s.jsx)("span",{className:"stock-text",children:"Out of Stock"})]}):e.quantity<=5?(0,s.jsxs)("span",{className:"low-stock-overlay",children:[(0,s.jsx)("span",{className:"stock-icon",children:"\u26a0\ufe0f"}),(0,s.jsx)("span",{className:"stock-text",children:"Low Stock"})]}):(0,s.jsxs)("span",{className:"in-stock-overlay",children:[(0,s.jsx)("span",{className:"stock-icon",children:"\u2705"}),(0,s.jsx)("span",{className:"stock-text",children:"In Stock"})]})}),e.updatedAt&&(0,s.jsx)("div",{className:"updated-badge",children:"Updated"}),e.isProtected&&(0,s.jsx)("div",{className:"protected-badge",children:"\ud83d\udd12 Protected"})]}),(0,s.jsxs)("div",{className:"product-info",children:[(0,s.jsx)("h3",{children:e.title}),(0,s.jsxs)("p",{className:"price",children:["$",e.price]}),(0,s.jsxs)("p",{className:"quantity",children:["Quantity: ",e.quantity||1]}),(0,s.jsx)("p",{className:"category",children:e.category}),e.description&&(0,s.jsx)("p",{className:"description",children:e.description}),(0,s.jsxs)("p",{className:"product-id",children:["ID: ",e.id]}),(0,s.jsxs)("p",{className:"created-date",children:["Created: ",new Date(e.createdAt).toLocaleDateString(),e.createdBy&&` by ${e.createdBy}`]}),e.updatedAt&&(0,s.jsxs)("p",{className:"updated-date",children:["Updated: ",new Date(e.updatedAt).toLocaleDateString(),e.updatedBy&&` by ${e.updatedBy}`]}),e.isProtected&&(0,s.jsx)("p",{className:"protected-info",children:"\ud83d\udd12 Protected Product - Only yahiapro400@gmail.com and yahiacool2009@gmail.com can modify"})]}),(0,s.jsxs)("div",{className:"product-actions",children:[(0,s.jsx)("button",{className:"edit-btn",onClick:()=>{q({...e,price:e.price.toString(),quantity:e.quantity.toString()}),u(!0)},title:"Edit Product",children:"\u270f\ufe0f Edit"}),(0,s.jsx)("button",{className:"delete-btn",onClick:()=>{const t=N.find(t=>t.id===e.id);if(t&&t.isProtected&&!T())alert("\u274c Cannot delete protected products!\n\nOnly yahiapro400@gmail.com and yahiacool2009@gmail.com can delete protected products.");else if(window.confirm("Are you sure you want to delete this product?")){const r=N.filter(t=>t.id!==e.id);w(r);try{const e=r.slice(-50),t=JSON.stringify(e);localStorage.setItem("ecommerce_products",t);if(!localStorage.getItem("ecommerce_products"))throw new Error("Failed to store products");console.log(`\u2705 Successfully deleted product. ${e.length} products remaining in localStorage`)}catch(a){console.error("Error deleting product:",a),m("\u26a0\ufe0f Warning: Product deleted but storage may be limited."),setTimeout(()=>m(""),5e3)}window.dispatchEvent(new Event("productsUpdated")),m(`Product "${t.title}" deleted successfully! Remaining products: ${r.length}`),setTimeout(()=>m(""),3e3)}},title:"Delete Product",children:"\ud83d\uddd1\ufe0f Delete"})]})]},e.id))})]}),y&&(0,s.jsxs)("div",{className:"categories-section",children:[(0,s.jsxs)("div",{className:"categories-header",children:[(0,s.jsxs)("h2",{children:["Categories Management (",b.length,")"]}),(0,s.jsxs)("div",{className:"categories-actions",children:[(0,s.jsx)("button",{className:"add-category-btn",onClick:()=>j(!f),children:f?"Cancel":"\u2795 Add New Category"}),(0,s.jsx)("button",{className:"back-to-top-btn",onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},children:"\u2b06\ufe0f Back to Top"})]})]}),f&&(0,s.jsx)("div",{className:"category-form",children:(0,s.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!E.trim())return void m("Please enter a category name");const t=E.trim().toLowerCase();if(b.includes(t))return void m("This category already exists");const a=[...b,t];I(a),localStorage.setItem("ecommerce_categories",JSON.stringify(a)),k(""),j(!1),m(`Category "${t}" added successfully!`),setTimeout(()=>m(""),3e3)},children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"newCategory",children:"Category Name"}),(0,s.jsx)("input",{type:"text",id:"newCategory",value:E,onChange:e=>k(e.target.value),placeholder:"Enter category name",required:!0})]}),(0,s.jsx)("button",{type:"submit",className:"submit-btn",children:"Add Category"})]})}),(0,s.jsx)("div",{className:"categories-grid",children:b.map(e=>(0,s.jsxs)("div",{className:"category-card",children:[(0,s.jsxs)("div",{className:"category-info",children:[(0,s.jsx)("h3",{children:e.charAt(0).toUpperCase()+e.slice(1)}),(0,s.jsxs)("p",{children:["Products in this category: ",N.filter(t=>t.category===e).length]})]}),(0,s.jsx)("div",{className:"category-actions",children:(0,s.jsx)("button",{className:"delete-category-btn",onClick:()=>(e=>{if(window.confirm(`Are you sure you want to delete the category "${e}"? This will also remove it from all products.`))try{const t=b.filter(t=>t!==e);I(t),localStorage.setItem("ecommerce_categories",JSON.stringify(t));const a=N.map(t=>t.category===e?{...t,category:"Other"}:t);w(a),localStorage.setItem("ecommerce_products",JSON.stringify(a)),window.dispatchEvent(new Event("productsUpdated")),m(`\u2705 Category "${e}" deleted successfully! Products moved to "Other" category.`),setTimeout(()=>m(""),4e3),console.log(`\u2705 Category "${e}" deleted and products updated`)}catch(t){console.error("Error deleting category:",t),m("\u26a0\ufe0f Error deleting category"),setTimeout(()=>m(""),3e3)}})(e),disabled:"other"===e,title:"other"===e?"Cannot delete default category":"Delete category",children:"\ud83d\uddd1\ufe0f Delete"})})]},e))})]})]})}}}]);
//# sourceMappingURL=614.ac916864.chunk.js.map